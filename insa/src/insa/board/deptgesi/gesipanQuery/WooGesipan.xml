<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace ="board">

  <typeAlias alias="gdto" type="model.gesipan_DTO"/>
  <typeAlias alias="dto" type="model.gasi_DTO"/> 
  
  <!-- 게시물 조회 -->
  
  <!-- 게시물 조회 --> 
	<!-- <select id="list" resultClass="dto" parameterClass="gdto">
  		select * from 
			(select rownum rn, A.* from 
				(select * from woo_board order by b_ref desc, b_level asc)A
			) 
		where rn between #tmpnum1# and #tmpnum2#
	</select> -->
  <select id="list" resultClass="gdto" >
  		select num, title, name, content, regdate from woo_board
  		order by num desc     </select> 
  <!-- 글쓰기  -->
  <insert id="write" parameterClass="gdto">
  		insert into woo_board(num, title, name, content, regdate, b_ref, b_step, b_level) values(woo_seq.nextval, #title#, #name#, #content#, sysdate, #b_ref#, 0, 0)    
  </insert> 
  <!-- 글쓰기전에 b_ref의 최대값에 +1 조회 -->
  <select id="maxRef" resultClass="integer">
  	select nvl(max(b_ref),0)+1 from woo_board
  </select>

  <!-- 게시물 상세조회 -->
  <select id="rview" resultClass="gdto" parameterClass="int">
  		select num, title, name, content , regdate from woo_board
  		where num = #num#   </select>
  <!--글 수정  -->
  <update id="update" parameterClass="gdto">
		update woo_board set title = #title#, content = #content#, regdate = sysdate
		where num = #num# </update>
  <!--글 삭제  -->
 <delete id="delete" parameterClass="int">
		delete from woo_board
		where num = #num#  </delete>
<!--  댓글조회 -->
 <select id="review_board" resultClass="dto" parameterClass="int">
		select gasinumber, num, content, id, insertdata from woo_board
		where gasiNumber = #num#   </select> 
<!-- 회원가입 -->
<insert id="insert" parameterClass="gdto">
  		insert into member(user_name, user_pass) values(#user_name#, #user_pass#)    </insert> 	
<select id="member_login" resultClass="gdto" parameterClass="gdto">
		select user_name, user_pass from member where user_name = #user_name# and user_pass= #user_pass#   		
</select>	

<!-- 답글쓰기1 인서트전 re1(그룹아이디) 에서 re2(순서구분) 부모값보다 큰값 모두 +1 -->

	<update id="re2Update" parameterClass="dto">
		update woo_board set b_step = b_step+1
		where b_step > #b_step#
 	</update>
	
<!-- 답글쓰기2 -->     
	 <insert id="rpl" parameterClass="dto">
		insert into woo_board(title, name, content, regdate, b_ref, b_step, b_level) 
		values(#title#, #name#, #content#, sysdate, #b_ref#, 0, 0)    </insert>  

</sqlMap>

